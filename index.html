<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TV CALL - CONEX√ÉO REAL</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --accent: #ff4757; --bg: #000; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: white; font-family: sans-serif; height: 100vh; overflow: hidden; }
        .main-container { height: 100vh; display: flex; flex-direction: column; position: relative; display: none; }
        #remote-video-container { flex: 1; background: #000; position: relative; }
        video { width: 100%; height: 100%; object-fit: cover; }
        #local-video { position: absolute; top: 20px; right: 20px; width: 100px; height: 140px; border-radius: 12px; border: 2px solid #fff; z-index: 10; }
        .controls { position: absolute; bottom: 50px; width: 100%; display: flex; justify-content: center; z-index: 20; }
        .btn-next { background: var(--accent); width: 80px; height: 80px; border-radius: 50%; border: none; color: white; font-size: 40px; cursor: pointer; }
        #start-screen { position: fixed; inset: 0; background: #121212; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn-start { padding: 20px 40px; border-radius: 50px; border: none; background: #fff; font-weight: bold; cursor: pointer; }
        #status { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; font-size: 12px; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color:var(--accent)">üì∫ TV CALL</h1>
        <input type="text" id="room-id" placeholder="Digite um nome para a sala" style="padding:15px; border-radius:10px; border:none; margin-bottom:10px; width:250px; text-align:center">
        <p style="font-size:12px; color:#888; margin-bottom:20px">Coloque o mesmo nome nos dois celulares</p>
        <button class="btn-start" onclick="conectar()">ENTRAR NA CALL</button>
    </div>

    <div class="main-container" id="app">
        <div id="status">Conectando...</div>
        <div id="remote-video-container">
            <video id="remote-video" autoplay playsinline></video>
            <video id="local-video" autoplay playsinline muted></video>
        </div>
        <div class="controls">
            <button class="btn-next" onclick="location.reload()">></button>
        </div>
    </div>

<script>
    let peer, localStream, currentCall;

    async function conectar() {
        const roomId = document.getElementById('room-id').value;
        if(!roomId) return alert("Digite um nome para a sala!");

        try {
            localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            document.getElementById('local-video').srcObject = localStream;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';

            // O segredo est√° aqui: o ID do Peer agora √© o nome da sala que voc√™ digitar
            // Celular 1 vira "nome-sala-1" e Celular 2 vira "nome-sala-2"
            const isFirst = Math.random() > 0.5;
            const myId = isFirst ? roomId + "-1" : roomId + "-2";
            const otherId = isFirst ? roomId + "-2" : roomId + "-1";

            peer = new Peer(myId);

            peer.on('open', (id) => {
                document.getElementById('status').innerText = "Procurando parceiro...";
                // Tenta ligar para o outro celular a cada 3 segundos at√© ele entrar
                const connectLoop = setInterval(() => {
                    const call = peer.call(otherId, localStream);
                    if(call) {
                        handleCall(call);
                        clearInterval(connectLoop);
                    }
                }, 3000);
            });

            peer.on('call', (call) => {
                call.answer(localStream);
                handleCall(call);
            });

        } catch (e) {
            alert("Erro ao acessar c√¢mera!");
        }
    }

    function handleCall(call) {
        call.on('stream', (remoteStream) => {
            document.getElementById('remote-video').srcObject = remoteStream;
            document.getElementById('status').innerText = "‚óè AO VIVO";
        });
    }
</script>
</body>
</html>
