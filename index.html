<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O IMPOSTOR PRO üî™</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --primary: #e74c3c; --bg: #0f0f1a; --card: #1c1c2d; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; }
        #game-container { background: var(--card); width: 95%; max-width: 500px; padding: 25px; border-radius: 30px; border: 3px solid #3b3b55; position: relative; box-sizing: border-box; }
        .config-icon { position: absolute; top: -55px; right: 5px; font-size: 32px; cursor: pointer; background: var(--card); padding: 10px; border-radius: 50%; border: 2px solid #3b3b55; z-index: 100; }
        .screen { display: none; flex-direction: column; gap: 12px; }
        .active { display: flex !important; }
        input, select { width: 100%; padding: 15px; border-radius: 12px; border: none; background: #2a2a40; color: #fff; font-size: 16px; box-sizing: border-box; outline: none; }
        button { width: 100%; padding: 18px; border-radius: 12px; border: none; background: #7289da; color: white; font-weight: bold; font-size: 16px; cursor: pointer; }
        .color-rainbow { background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet); -webkit-background-clip: text; color: transparent; animation: rainbow 2s infinite; font-weight: bold; }
        @keyframes rainbow { 0%{filter: hue-rotate(0deg)} 100%{filter: hue-rotate(360deg)} }
        .color-gold { color: #f1c40f; text-shadow: 0 0 5px gold; font-weight: bold; }
        .name-black { background-color: #000; color: #fff !important; padding: 2px 5px; border-radius: 4px; }
        #chat-box { height: 180px; overflow-y: auto; background: #0a0a14; padding: 10px; border-radius: 15px; border: 2px solid #3b3b55; margin-bottom: 5px; }
        .msg { margin-bottom: 5px; font-size: 14px; }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="config-icon" onclick="toggleSettings()">‚öôÔ∏è</div>

        <div id="settings-panel" style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; background:#2a2a40; padding:20px; border-radius:20px; z-index:500; border:2px solid #fff;">
            <p>Moedas: <span id="my-money">0</span>üí∞</p>
            <div class="color-row" onclick="setColor('white')">Branco</div>
            <div class="color-row" onclick="setColor('black')">Preto</div>
            <div class="color-row" onclick="buyColor('gold', 200)" class="color-gold">Dourado</div>
            <div class="color-row" onclick="buyColor('rainbow', 400)" class="color-rainbow">Arco-√≠ris</div>
            <button onclick="toggleSettings()" style="margin-top:10px">FECHAR</button>
        </div>

        <div id="setup-screen" class="screen active">
            <h1 style="text-align:center">O IMPOSTOR PRO</h1>
            <input type="text" id="player-name" placeholder="Nome">
            <select id="max-players">
                <option value="2">2 JOGADORES</option>
                <option value="3" selected>3 JOGADORES</option>
                <option value="5">5 JOGADORES</option>
            </select>
            <input type="password" id="room-pass" placeholder="Senha da Sala">
            <button onclick="setupHost()" style="background:#27ae60">CRIAR SALA</button>
            <hr style="width:100%; border:1px solid #333">
            <input type="text" id="join-id" placeholder="C√≥digo">
            <input type="password" id="join-pass-input" placeholder="Senha">
            <button onclick="joinRoom()">ENTRAR</button>
        </div>

        <div id="game-screen" class="screen">
            <div style="display:flex; justify-content:space-between">
                <span id="player-counter">1/--</span>
                <button onclick="location.reload()" style="width:auto; padding:5px; background:red">SAIR</button>
            </div>
            
            <div id="role-area" style="background:#444; padding:15px; border-radius:10px; text-align:center; font-weight:bold; color:#f1c40f">
                AGUARDANDO IN√çCIO...
            </div>

            <button id="start-btn" onclick="startGame()" style="display:none; background:#f1c40f; color:#000">GERAR PALAVRA üîë</button>

            <div id="chat-box"></div>
            <div style="display:flex; gap:5px">
                <input type="text" id="chat-input" placeholder="...">
                <button onclick="sendMsg()" style="width:60px">OK</button>
            </div>
            <button id="voice-btn" onclick="toggleVoice()" style="background:#444">VOICE: DESLIGADO üîá</button>
            <button onclick="navigator.clipboard.writeText(peer.id); alert('Copiado!')" style="font-size:10px">COPIAR C√ìDIGO ¬©Ô∏è</button>
        </div>
    </div>

<script>
    let peer = new Peer(), conn, myStream, isHost = false, players = [], maxP = 3, micOn = false;
    let myColor = 'white', myCountry = 'üáßüá∑', myCoins = 0;
    const palavras = ["Cachorro", "Pizza", "Futebol", "Escola", "Celular", "Avi√£o", "Praia"];

    async function initVoice() {
        try {
            myStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            myStream.getAudioTracks()[0].enabled = false;
            peer.on('call', call => {
                call.answer(myStream);
                call.on('stream', s => { const a = new Audio(); a.srcObject = s; a.play(); });
            });
        } catch(e) { alert("Permita o Microfone!"); }
    }

    function toggleVoice() {
        if(!myStream) return;
        micOn = !micOn;
        myStream.getAudioTracks()[0].enabled = micOn;
        document.getElementById('voice-btn').style.background = micOn ? '#27ae60' : '#444';
        document.getElementById('voice-btn').innerText = micOn ? "VOICE: LIGADO üé§" : "VOICE: DESLIGADO üîá";
    }

    function setupHost() {
        if(!document.getElementById('room-pass').value) return alert("Senha obrigat√≥ria!");
        isHost = true;
        maxP = parseInt(document.getElementById('max-players').value);
        initVoice();
        document.getElementById('start-btn').style.display = 'block';
        showScreen('game-screen');
        updateCounter();

        peer.on('connection', c => {
            c.on('data', data => {
                if(data.type === 'auth' && data.pass === document.getElementById('room-pass').value) {
                    players.push({id: c.peer, conn: c, name: data.name});
                    c.send({type:'auth_ok', max: maxP});
                    peer.call(c.peer, myStream); // Liga para quem entrou
                    updateCounter();
                }
            });
            c.on('close', () => { 
                players = players.filter(p => p.id !== c.peer); 
                updateCounter(); 
            });
        });
    }

    function joinRoom() {
        initVoice();
        conn = peer.connect(document.getElementById('join-id').value);
        conn.on('open', () => {
            conn.send({type:'auth', pass: document.getElementById('join-pass-input').value, name: document.getElementById('player-name').value});
        });
        conn.on('data', data => {
            if(data.type === 'auth_ok') { maxP = data.max; showScreen('game-screen'); }
            if(data.type === 'role') { document.getElementById('role-area').innerText = data.msg; }
            if(data.type === 'chat') addMsg(data);
        });
    }

    function startGame() {
        if(players.length < 1) return alert("Precisa de mais gente!");
        const palavra = palavras[Math.floor(Math.random() * palavras.length)];
        const all = [peer.id, ...players.map(p => p.id)];
        const impostor = all[Math.floor(Math.random() * all.length)];
        
        const sendRole = (id, msg) => {
            if(id === peer.id) document.getElementById('role-area').innerText = msg;
            else players.find(p => p.id === id).conn.send({type:'role', msg: msg});
        };

        all.forEach(id => {
            if(id === impostor) sendRole(id, "VOC√ä √â O IMPOSTOR! üî™");
            else sendRole(id, "PALAVRA: " + palavra);
        });
    }

    function updateCounter() {
        const total = players.length + 1;
        document.getElementById('player-counter').innerText = total + "/" + maxP;
    }

    function sendMsg() {
        const txt = document.getElementById('chat-input').value;
        const data = {type:'chat', name: document.getElementById('player-name').value, text: txt, color: myColor};
        if(isHost) { addMsg(data); players.forEach(p => p.conn.send(data)); } else { conn.send(data); }
        document.getElementById('chat-input').value = "";
    }

    function addMsg(data) {
        document.getElementById('chat-box').innerHTML += `<div><b>${data.name}:</b> ${data.text}</div>`;
        document.getElementById('chat-box').scrollTop = 9999;
    }

    function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function toggleSettings() { const s = document.getElementById('settings-panel'); s.style.display = s.style.display === 'none' ? 'block' : 'none'; }
    function setColor(c) { myColor = c; }
</script>
</body>
</html>
